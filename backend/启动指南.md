# FastAPI åº”ç”¨å¯åŠ¨æŒ‡å—

## âŒ é”™è¯¯çš„å¯åŠ¨æ–¹å¼

```bash
# é”™è¯¯1: ç›´æ¥è¿è¡Œ main.py
python backend/app/main.py
# æŠ¥é”™: ModuleNotFoundError: No module named 'app'

# é”™è¯¯2: åœ¨ app ç›®å½•ä¸‹è¿è¡Œ
cd backend/app
python main.py
# æŠ¥é”™: ModuleNotFoundError: No module named 'app'
```

**åŸå› **: Python æ— æ³•æ‰¾åˆ° `app` æ¨¡å—ï¼Œå› ä¸ºå½“å‰å·¥ä½œç›®å½•ä¸æ­£ç¡®ã€‚

---

## âœ… æ­£ç¡®çš„å¯åŠ¨æ–¹å¼

### æ–¹å¼ 1: ä½¿ç”¨ uvicornï¼ˆæ¨è - å¼€å‘ç¯å¢ƒï¼‰

```bash
# 1. è¿›å…¥ backend ç›®å½•
cd backend

# 2. æ¿€æ´» conda ç¯å¢ƒ
conda activate xiehe

# 3. ä½¿ç”¨ uvicorn å¯åŠ¨
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**å‚æ•°è¯´æ˜**:
- `app.main:app` - æ¨¡å—è·¯å¾„:åº”ç”¨å®ä¾‹
- `--reload` - ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡å¯ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
- `--host 0.0.0.0` - ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
- `--port 8000` - ç«¯å£å·

---

### æ–¹å¼ 2: ä½¿ç”¨ Python -m è¿è¡Œ

```bash
# 1. è¿›å…¥ backend ç›®å½•
cd backend

# 2. æ¿€æ´» conda ç¯å¢ƒ
conda activate xiehe

# 3. ä½¿ç”¨ -m å‚æ•°è¿è¡Œ
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

### æ–¹å¼ 3: ä¿®æ”¹ main.py çš„å¯åŠ¨ä»£ç ï¼ˆä¸æ¨èï¼‰

å¦‚æœä¸€å®šè¦ç›´æ¥è¿è¡Œ `python app/main.py`ï¼Œéœ€è¦ä¿®æ”¹ `main.py` æ–‡ä»¶ï¼š

```python
# åœ¨ main.py æ–‡ä»¶å¼€å¤´æ·»åŠ 
import sys
from pathlib import Path

# å°† backend ç›®å½•æ·»åŠ åˆ° Python è·¯å¾„
backend_dir = Path(__file__).parent.parent
sys.path.insert(0, str(backend_dir))
```

ä½†è¿™ç§æ–¹å¼**ä¸æ¨è**ï¼Œå› ä¸ºä¼šå¯¼è‡´è·¯å¾„æ··ä¹±ã€‚

---

### æ–¹å¼ 4: ä½¿ç”¨ gunicornï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# 1. è¿›å…¥ backend ç›®å½•
cd backend

# 2. æ¿€æ´» conda ç¯å¢ƒ
conda activate xiehe

# 3. ä½¿ç”¨ gunicorn å¯åŠ¨
gunicorn app.main:app -c gunicorn.conf.py
```

---

## ğŸš€ å®Œæ•´å¯åŠ¨æµç¨‹ï¼ˆæ¨èï¼‰

### æ­¥éª¤ 1: æ‰“å¼€ç»ˆç«¯

åœ¨ VSCode ä¸­æ‰“å¼€ç»ˆç«¯ï¼ˆCtrl + `ï¼‰æˆ–ä½¿ç”¨ PowerShell

### æ­¥éª¤ 2: å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•

```powershell
cd D:\work\æ˜Ÿçº¬ç®—æ³•\åå’ŒåŒ»é™¢\ä»£ç \XieHe-System
```

### æ­¥éª¤ 3: è¿›å…¥ backend ç›®å½•

```powershell
cd backend
```

### æ­¥éª¤ 4: æ¿€æ´» conda ç¯å¢ƒ

```powershell
conda activate xiehe
```

### æ­¥éª¤ 5: å¯åŠ¨åº”ç”¨

```powershell
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### æ­¥éª¤ 6: éªŒè¯å¯åŠ¨æˆåŠŸ

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š

```
INFO:     Will watch for changes in these directories: ['D:\\work\\æ˜Ÿçº¬ç®—æ³•\\åå’ŒåŒ»é™¢\\ä»£ç \\XieHe-System\\backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### æ­¥éª¤ 7: è®¿é—®åº”ç”¨

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- API æ–‡æ¡£: http://localhost:8000/api/v1/docs
- å¥åº·æ£€æŸ¥: http://localhost:8000/health
- æ ¹è·¯å¾„: http://localhost:8000/

---

## ğŸ”§ ä¸€é”®å¯åŠ¨è„šæœ¬

ä¸ºäº†æ–¹ä¾¿å¯åŠ¨ï¼Œå¯ä»¥åˆ›å»ºå¯åŠ¨è„šæœ¬ï¼š

### Windows PowerShell è„šæœ¬

åˆ›å»º `backend/start.ps1`:

```powershell
# å¯åŠ¨ FastAPI åº”ç”¨
Write-Host "ğŸš€ å¯åŠ¨ XieHe åŒ»ç–—å½±åƒè¯Šæ–­ç³»ç»Ÿ..." -ForegroundColor Green

# æ£€æŸ¥æ˜¯å¦åœ¨ backend ç›®å½•
if (-not (Test-Path "app/main.py")) {
    Write-Host "âŒ é”™è¯¯: è¯·åœ¨ backend ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬" -ForegroundColor Red
    exit 1
}

# æ¿€æ´» conda ç¯å¢ƒ
Write-Host "ğŸ“¦ æ¿€æ´» conda ç¯å¢ƒ: xiehe" -ForegroundColor Yellow
conda activate xiehe

# å¯åŠ¨åº”ç”¨
Write-Host "ğŸŒ å¯åŠ¨åº”ç”¨åœ¨ http://localhost:8000" -ForegroundColor Cyan
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

ä½¿ç”¨æ–¹å¼ï¼š
```powershell
cd backend
.\start.ps1
```

### Linux/Mac Bash è„šæœ¬

åˆ›å»º `backend/start.sh`:

```bash
#!/bin/bash

# å¯åŠ¨ FastAPI åº”ç”¨
echo "ğŸš€ å¯åŠ¨ XieHe åŒ»ç–—å½±åƒè¯Šæ–­ç³»ç»Ÿ..."

# æ£€æŸ¥æ˜¯å¦åœ¨ backend ç›®å½•
if [ ! -f "app/main.py" ]; then
    echo "âŒ é”™è¯¯: è¯·åœ¨ backend ç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# æ¿€æ´» conda ç¯å¢ƒ
echo "ğŸ“¦ æ¿€æ´» conda ç¯å¢ƒ: xiehe"
source ~/miniconda3/etc/profile.d/conda.sh
conda activate xiehe

# å¯åŠ¨åº”ç”¨
echo "ğŸŒ å¯åŠ¨åº”ç”¨åœ¨ http://localhost:8000"
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
cd backend
chmod +x start.sh
./start.sh
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: ModuleNotFoundError: No module named 'app'

**åŸå› **: å½“å‰å·¥ä½œç›®å½•ä¸æ­£ç¡®

**è§£å†³**:
```bash
# ç¡®ä¿åœ¨ backend ç›®å½•ä¸‹
cd backend
pwd  # æˆ– Windows ä¸‹ç”¨ cdï¼ˆæŸ¥çœ‹å½“å‰ç›®å½•ï¼‰

# ç„¶åå¯åŠ¨
uvicorn app.main:app --reload
```

### é—®é¢˜ 2: ModuleNotFoundError: No module named 'uvicorn'

**åŸå› **: uvicorn æœªå®‰è£…

**è§£å†³**:
```bash
conda activate xiehe
pip install uvicorn
```

### é—®é¢˜ 3: ç«¯å£ 8000 å·²è¢«å ç”¨

**åŸå› **: ç«¯å£è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼ˆå¯èƒ½æ˜¯ä¹‹å‰çš„ start_demo.pyï¼‰

**è§£å†³**:
```powershell
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr "8000"

# æ€æ­»è¿›ç¨‹ï¼ˆæ›¿æ¢ PID ä¸ºå®é™…è¿›ç¨‹ IDï¼‰
taskkill /PID <PID> /F

# æˆ–è€…ä½¿ç”¨å…¶ä»–ç«¯å£
uvicorn app.main:app --reload --port 8001
```

### é—®é¢˜ 4: æ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› **: æ•°æ®åº“é…ç½®ä¸æ­£ç¡®æˆ–æ•°æ®åº“æœªå¯åŠ¨

**è§£å†³**:
```bash
# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®
cat .env

# æˆ–åˆ›å»º .env æ–‡ä»¶
# åœ¨ backend ç›®å½•ä¸‹åˆ›å»º .env æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
```

åˆ›å»º `backend/.env`:
```env
# æ•°æ®åº“é…ç½®
DB_HOST=115.190.121.59
DB_PORT=3306
DB_USER=root
DB_PASSWORD=qweasd2025
DB_NAME=medical_imaging_system

# åº”ç”¨é…ç½®
ENVIRONMENT=development
DEBUG=true
SECRET_KEY=your-secret-key-here

# API é…ç½®
API_V1_STR=/api/v1
```

---

## ğŸ“ æ€»ç»“

**æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼**:

```bash
# 1. æ‰“å¼€ç»ˆç«¯
# 2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
cd D:\work\æ˜Ÿçº¬ç®—æ³•\åå’ŒåŒ»é™¢\ä»£ç \XieHe-System\backend
conda activate xiehe
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**å…³é”®ç‚¹**:
- âœ… å¿…é¡»åœ¨ `backend` ç›®å½•ä¸‹è¿è¡Œ
- âœ… ä½¿ç”¨ `uvicorn app.main:app` è€Œä¸æ˜¯ `python app/main.py`
- âœ… æ¿€æ´»æ­£ç¡®çš„ conda ç¯å¢ƒ `xiehe`
- âœ… ç¡®ä¿æ•°æ®åº“é…ç½®æ­£ç¡®

